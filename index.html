<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tempo Shop - Премиум часы</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Все предыдущие стили остаются без изменений */
        /* ... */

        /* Выпадающее меню брендов */
        .brands-dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background-color: var(--card-bg);
            min-width: 200px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
            z-index: 1000;
            border-radius: 10px;
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .dropdown-content.show {
            display: block;
        }

        .dropdown-content a {
            color: var(--text);
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            transition: all 0.3s;
            border-bottom: 1px solid var(--border);
        }

        .dropdown-content a:last-child {
            border-bottom: none;
        }

        .dropdown-content a:hover {
            background-color: var(--accent);
            color: var(--primary);
        }

        /* Остальные стили без изменений */
        /* ... */
    </style>
</head>
<body>
    <!-- Шапка сайта -->
    <header>
        <div class="header-content">
            <div class="logo-container">
                <div class="logo">
                    <div class="logo-main">TempoShop</div>
                    <div class="logo-subtitle">Магазин элитных часов</div>
                </div>
            </div>
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Поиск часов...">
                <i class="fas fa-search search-icon"></i>
            </div>
            <div class="brands-dropdown">
                <button class="menu-btn" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="dropdown-content" id="brandsDropdown">
                    <a href="#" class="brand-filter" data-brand="all">Все бренды</a>
                    <a href="#" class="brand-filter" data-brand="Rolex">Rolex</a>
                    <a href="#" class="brand-filter" data-brand="Omega">Omega</a>
                    <a href="#" class="brand-filter" data-brand="Tag Heuer">Tag Heuer</a>
                    <a href="#" class="brand-filter" data-brand="Cartier">Cartier</a>
                    <a href="#" class="brand-filter" data-brand="Breitling">Breitling</a>
                    <a href="#" class="brand-filter" data-brand="Patek Philippe">Patek Philippe</a>
                    <a href="#" class="brand-filter" data-brand="Apple">Apple</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Остальной код без изменений -->
    <!-- ... -->

    <script>
        // Данные товаров (без изменений)
        const products = [
            // ... (ваши товары)
        ];

        // Данные для разделов помощи (без изменений)
        const helpSections = {
            // ... (ваши разделы помощи)
        };

        // Элементы DOM
        const productsGrid = document.getElementById('productsGrid');
        const searchInput = document.querySelector('.search-input');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const brandFilters = document.querySelectorAll('.brand-filter');
        const brandCards = document.querySelectorAll('.brand-card');
        const categoryFilters = document.querySelectorAll('.category-filter');
        const productModal = document.getElementById('productModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBrand = document.getElementById('modalBrand');
        const modalImage = document.getElementById('modalImage');
        const modalPrice = document.getElementById('modalPrice');
        const modalOldPrice = document.getElementById('modalOldPrice');
        const modalDescription = document.getElementById('modalDescription');
        const modalFeatures = document.getElementById('modalFeatures');
        const modalBuyBtn = document.getElementById('modalBuyBtn');
        const closeModal = document.querySelector('.close-modal');

        // Элементы модального окна помощи
        const helpModal = document.getElementById('helpModal');
        const helpModalTitle = document.getElementById('helpModalTitle');
        const helpModalBody = document.getElementById('helpModalBody');
        const closeHelpModal = document.querySelector('.close-help-modal');
        const helpLinks = document.querySelectorAll('.help-link');

        // Новые элементы для меню брендов
        const menuToggle = document.getElementById('menuToggle');
        const brandsDropdown = document.getElementById('brandsDropdown');

        // Переменные состояния
        let currentCategory = 'all';
        let currentBrand = 'all';
        let searchQuery = '';
        let isMenuOpen = false; // Добавляем состояние меню

        // Инициализация
        function init() {
            renderProducts(products);
            setupEventListeners();
        }

        // Настройка обработчиков событий
        function setupEventListeners() {
            // Переключение меню брендов
            menuToggle.addEventListener('click', (e) => {
                e.stopPropagation(); // Предотвращаем всплытие
                toggleBrandsMenu();
            });

            // Закрытие меню при клике вне его
            document.addEventListener('click', (e) => {
                if (!brandsDropdown.contains(e.target) && !menuToggle.contains(e.target)) {
                    closeBrandsMenu();
                }
            });

            // Поиск
            searchInput.addEventListener('input', (e) => {
                searchQuery = e.target.value.toLowerCase();
                filterProducts();
            });

            // Фильтры по категориям
            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    filterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentCategory = btn.getAttribute('data-category');
                    filterProducts();
                    closeBrandsMenu(); // Закрываем меню при выборе категории
                });
            });

            // Фильтры по брендам в меню
            brandFilters.forEach(filter => {
                filter.addEventListener('click', (e) => {
                    e.preventDefault();
                    currentBrand = filter.getAttribute('data-brand');
                    filterProducts();
                    closeBrandsMenu(); // Закрываем меню при выборе бренда
                });
            });

            // Фильтры по брендам в карточках
            brandCards.forEach(card => {
                card.addEventListener('click', () => {
                    currentBrand = card.getAttribute('data-brand');
                    filterProducts();
                    closeBrandsMenu(); // Закрываем меню при выборе бренда
                });
            });

            // Фильтры по категориям в подвале
            categoryFilters.forEach(filter => {
                filter.addEventListener('click', (e) => {
                    e.preventDefault();
                    currentCategory = filter.getAttribute('data-category');
                    // Активируем соответствующую кнопку фильтра
                    filterBtns.forEach(btn => {
                        if (btn.getAttribute('data-category') === currentCategory) {
                            btn.click();
                        }
                    });
                    closeBrandsMenu(); // Закрываем меню при выборе категории
                });
            });

            // Закрытие модального окна товара
            closeModal.addEventListener('click', () => {
                productModal.style.display = 'none';
            });

            // Закрытие модального окна помощи
            closeHelpModal.addEventListener('click', () => {
                helpModal.style.display = 'none';
            });

            // Закрытие модальных окон при клике вне их
            window.addEventListener('click', (e) => {
                if (e.target === productModal) {
                    productModal.style.display = 'none';
                }
                if (e.target === helpModal) {
                    helpModal.style.display = 'none';
                }
            });

            // Обработчики для ссылок помощи
            helpLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = link.getAttribute('data-section');
                    openHelpModal(section);
                    closeBrandsMenu(); // Закрываем меню при открытии помощи
                });
            });
        }

        // Функции для работы с меню брендов
        function toggleBrandsMenu() {
            if (isMenuOpen) {
                closeBrandsMenu();
            } else {
                openBrandsMenu();
            }
        }

        function openBrandsMenu() {
            brandsDropdown.classList.add('show');
            isMenuOpen = true;
        }

        function closeBrandsMenu() {
            brandsDropdown.classList.remove('show');
            isMenuOpen = false;
        }

        // Открытие модального окна помощи
        function openHelpModal(section) {
            if (helpSections[section]) {
                helpModalTitle.textContent = helpSections[section].title;
                helpModalBody.innerHTML = helpSections[section].content;
                helpModal.style.display = 'block';
            }
        }

        // Фильтрация товаров
        function filterProducts() {
            let filteredProducts = products;

            // Фильтрация по категории
            if (currentCategory !== 'all') {
                filteredProducts = filteredProducts.filter(product => 
                    product.category === currentCategory
                );
            }

            // Фильтрация по бренду
            if (currentBrand !== 'all') {
                filteredProducts = filteredProducts.filter(product => 
                    product.brand === currentBrand
                );
            }

            // Фильтрация по поисковому запросу
            if (searchQuery) {
                filteredProducts = filteredProducts.filter(product => 
                    product.title.toLowerCase().includes(searchQuery) ||
                    product.brand.toLowerCase().includes(searchQuery) ||
                    product.description.toLowerCase().includes(searchQuery)
                );
            }

            renderProducts(filteredProducts);
        }

        // Отрисовка товаров
        function renderProducts(productsToRender) {
            productsGrid.innerHTML = '';

            if (productsToRender.length === 0) {
                productsGrid.innerHTML = `
                    <div class="no-results">
                        <div class="no-results-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <p>Товары не найдены</p>
                        <p>Попробуйте изменить параметры поиска или фильтры</p>
                    </div>
                `;
                return;
            }

            productsToRender.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <div class="product-image-container">
                        <img src="${product.image}" alt="${product.title}" class="product-image">
                        ${product.oldPrice ? `<div class="product-badge">-${Math.round((1 - product.price / product.oldPrice) * 100)}%</div>` : ''}
                    </div>
                    <div class="product-info">
                        <div class="product-brand">${product.brand}</div>
                        <div class="product-title">${product.title}</div>
                        <div class="product-price">
                            ${product.price.toLocaleString()} ₽
                            ${product.oldPrice ? `<span class="product-old-price">${product.oldPrice.toLocaleString()} ₽</span>` : ''}
                        </div>
                        <div class="product-description">${product.description}</div>
                        <div class="product-actions">
                            <button class="buy-btn" data-id="${product.id}">
                                <i class="fas fa-shopping-cart"></i> Купить
                            </button>
                        </div>
                    </div>
                `;
                productsGrid.appendChild(productCard);

                // Обработчик клика по карточке товара
                productCard.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('buy-btn')) {
                        openProductModal(product);
                    }
                });

                // Обработчик клика по кнопке "Купить"
                const buyBtn = productCard.querySelector('.buy-btn');
                buyBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    openProductModal(product);
                });
            });
        }

        // Открытие модального окна товара
        function openProductModal(product) {
            modalTitle.textContent = product.title;
            modalBrand.textContent = product.brand;
            modalImage.src = product.image;
            modalImage.alt = product.title;
            modalPrice.textContent = `${product.price.toLocaleString()} ₽`;
            
            if (product.oldPrice) {
                modalOldPrice.textContent = `${product.oldPrice.toLocaleString()} ₽`;
                modalOldPrice.style.display = 'block';
            } else {
                modalOldPrice.style.display = 'none';
            }
            
            modalDescription.textContent = product.description;
            
            // Очистка и заполнение особенностей
            modalFeatures.innerHTML = '';
            product.features.forEach(feature => {
                const li = document.createElement('li');
                li.textContent = feature;
                modalFeatures.appendChild(li);
            });
            
            // Настройка кнопки для перехода в Telegram
            const telegramUsername = "Tempo_63";
            const message = `Здравствуйте! Я хочу купить часы: ${product.brand} ${product.title} за ${product.price.toLocaleString()} ₽`;
            const telegramUrl = `https://t.me/${telegramUsername}?text=${encodeURIComponent(message)}`;
            modalBuyBtn.href = telegramUrl;
            
            productModal.style.display = 'block';
        }

        // Запуск приложения
        init();
    </script>
</body>
</html>